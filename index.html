<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Wolt Cash Debt Checker Tool</title>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to right, #e3f2fd, #ffffff);
            color: #333;
            text-align: center;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            color: black;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #0078FF;
            margin-bottom: 20px;
        }
        h3 {
            text-align: center;
            color: #0078FF;
            margin-top: 20px;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            background-color: #0078FF;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: 0.3s;
            box-shadow: 0 4px 8px rgba(0, 120, 255, 0.3);
        }
        button:hover {
            background-color: #005bb5;
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 120, 255, 0.4);
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –±–ª–æ–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª" */
        .file-input-container {
            margin: 20px 0;
            text-align: center;
        }
        /* –ü–æ–¥–ø–∏—Å—å –Ω–∞–¥ –∫–Ω–æ–ø–∫–æ–π */
        .file-label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #0078FF;
        }
        /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π input[type="file"] */
        .file-input-container input[type="file"] {
            display: none;
        }
        /* –°—Ç–∏–ª–∏–∑—É–µ–º label, —á—Ç–æ–±—ã –≤—ã–≥–ª—è–¥–µ–ª–∞ –∫–∞–∫ –∫–Ω–æ–ø–∫–∞ */
        .custom-file-upload {
            display: inline-block;
            background-color: #0078FF;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: 0.3s;
            box-shadow: 0 4px 8px rgba(0, 120, 255, 0.3);
        }
        .custom-file-upload:hover {
            background-color: #005bb5;
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 120, 255, 0.4);
        }
        /* –ü–æ–¥–ø–∏—Å—å "–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω" */
        .file-chosen {
            margin-left: 10px;
            font-size: 14px;
            color: #555;
        }

        #output {
            margin-top: 20px;
            text-align: center;
            font-size: 16px;
        }
        .courier-box {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin: 5px auto;
            max-width: 320px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: 0.3s;
        }
        .courier-box:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        a {
            color: #0078FF;
            text-decoration: none;
            font-weight: bold;
            display: block;
        }
        a:hover {
            text-decoration: underline;
        }
        #loading {
            display: none;
            font-size: 16px;
            color: #0078FF;
            margin-top: 10px;
        }
        #searchInput {
            padding: 8px;
            margin-top: 10px;
            width: 80%;
            border: 1px solid #0078FF;
            border-radius: 4px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
        .dark-mode {
            background: #121212 !important;
            color: white;
        }
        .dark-mode .container {
            background: #1e1e1e;
            color: white;
            box-shadow: 0 4px 10px rgba(255, 255, 255, 0.1);
        }
        .dark-mode input[type="file"], 
        .dark-mode input[type="text"] {
            background: #1e1e1e;
            color: white;
            border-color: #0078FF;
        }
        .dark-mode .courier-box {
            background: #2c2c2c;
            border: 1px solid #444;
            color: white;
        }
        .dark-mode button {
            background-color: #333;
            color: white;
        }
        .dark-mode button:hover {
            background-color: #444;
        }
        .dark-mode .container {
            background: #2c2c2c;
            color: white;
        }
        .dark-mode button {
            background-color: #0078FF;
            color: white;
        }
        .dark-mode button:hover {
            background-color: #005bb5;
        }
        .dark-mode .courier-box {
            background: #3a3a3a;
        }
        .dark-mode a {
            color: #4fa3ff;
        }
        .dark-mode .custom-file-upload {
            background-color: #333;
        }
        .dark-mode .custom-file-upload:hover {
            background-color: #444;
        }
        .dark-mode .file-chosen {
            color: #ccc;
        }

        /* –¢–æ–≥–≥–ª-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å (—Å–æ–ª–Ω—Ü–µ/–ª—É–Ω–∞) */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin-top: 10px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: background-color 0.4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: #fff;
            transition: transform 0.4s;
            border-radius: 50%;
        }
        .sun,
        .moon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            pointer-events: none;
            transition: opacity 0.4s, transform 0.4s;
        }
        .sun {
            left: 8px;
            opacity: 1;
            transform: translateY(-50%) scale(1);
        }
        .moon {
            right: 8px;
            opacity: 0;
            transform: translateY(-50%) scale(0.5);
        }
        input:checked + .slider {
            background-color: #0078FF;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        input:checked + .slider .sun {
            opacity: 0;
            transform: translateY(-50%) scale(0.5);
        }
        input:checked + .slider .moon {
            opacity: 1;
            transform: translateY(-50%) scale(1);
        }

        .button-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 15px;
        }
        .button-container button {
            padding: 10px 15px;
            font-size: 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background-color: #0078FF;
            color: white;
            transition: 0.3s;
        }
        .button-container button:hover {
            background-color: #005bb5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Wolt Cash Debt Checker Tool</h2>
        
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã (toggle) -->
        <label class="switch">
            <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
            <span class="slider round">
                <span class="sun">‚òÄÔ∏è</span>
                <span class="moon">üåô</span>
            </span>
        </label>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ CSV -->
        <div class="file-input-container">
            <span class="file-label">–ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV-—Ñ–∞–π–ª</span>
            <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ (—á–µ—Ä–µ–∑ label) -->
            <label for="fileInput" class="custom-file-upload">–í—ã–±—Ä–∞—Ç—å CSV</label>
            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ -->
            <span class="file-chosen" id="fileCSVName">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
            <!-- –°–∫—Ä—ã—Ç—ã–π input -->
            <input type="file" id="fileInput" accept=".csv" onchange="processCSV(); updateFileName('fileInput','fileCSVName')" />
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ PDF -->
        <div class="file-input-container">
            <span class="file-label">–ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF-—Ñ–∞–π–ª</span>
            <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ (—á–µ—Ä–µ–∑ label) -->
            <label for="pdfInput" class="custom-file-upload">–í—ã–±—Ä–∞—Ç—å PDF</label>
            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ -->
            <span class="file-chosen" id="filePDFName">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
            <!-- –°–∫—Ä—ã—Ç—ã–π input -->
            <input type="file" id="pdfInput" accept=".pdf" onchange="processPDF(); updateFileName('pdfInput','filePDFName')" />
        </div>

        <div class="button-container">
            <button id="openAllButton" style="display:none;" onclick="openAllLinks()">Open all links</button>
            <button id="copyLinksButton" style="display:none;" onclick="copyLinks()">Copy all links</button>
            <button id="downloadCSVButton" style="display:none;" onclick="downloadCSV()">Download CSV for bulk</button>
        </div>
        
        <input type="text" id="searchInput" list="courierSuggestions" placeholder="Search for courier ID..." onkeyup="filterCouriers()" style="display: none;">
        <datalist id="courierSuggestions"></datalist>

        <div id="loading">Processing file...</div>
        <div id="output"></div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è pdf.js
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

        let courierLinks = [];
        let courierIds = [];

        // =============== CSV ===============
        function processCSV() {
            resetOutput();
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ CSV-—Ñ–∞–π–ª!');
                return;
            }
            document.getElementById('loading').style.display = 'block';

            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('loading').style.display = 'none';
                const text = event.target.result;
                const lines = text.split('\n');

                // –ù–∞—á–∏–Ω–∞–µ–º —Å i=1, —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
                for (let i = 1; i < lines.length; i++) {
                    let columns = lines[i].split(',');
                    if (columns.length > 1 && !isNaN(columns[1].trim())) {
                        let id = columns[1].trim();
                        addCourierId(id);
                    }
                }
                showResults();
            };
            reader.readAsText(fileInput.files[0]);
        }

        // =============== PDF ===============
        async function processPDF() {
            resetOutput();
            const pdfInput = document.getElementById('pdfInput');
            if (!pdfInput.files.length) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ PDF-—Ñ–∞–π–ª!');
                return;
            }
            document.getElementById('loading').style.display = 'block';

            try {
                // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ ArrayBuffer
                const file = pdfInput.files[0];
                const arrayBuffer = await file.arrayBuffer();

                // –ó–∞–≥—Ä—É–∂–∞–µ–º PDF
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let textContentAll = '';

                // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã PDF
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();

                    // –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    textContentAll += pageText + '\n';
                }

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º RegExp –¥–ª—è –ø–æ–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–∞: "1 6225498"
                const regex = /(\d+)\s+(\d{6,})/g;
                let match;
                while ((match = regex.exec(textContentAll)) !== null) {
                    let id = match[2];
                    addCourierId(id);
                }

                showResults();
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                console.error(error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ PDF-—Ñ–∞–π–ª–∞.');
                document.getElementById('loading').style.display = 'none';
            }
        }

        // =============== –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ ===============
        function addCourierId(id) {
            courierIds.push(id);
            courierLinks.push(`https://ops.wolt.com/couriers/${id}`);
        }

        function showResults() {
            if (courierIds.length > 0) {
                document.getElementById('searchInput').style.display = 'block';
                const outputDiv = document.getElementById('output');
                outputDiv.innerHTML = '<h3>Courier IDs:</h3>';
                courierIds.forEach((id, index) => {
                    const a = document.createElement('a');
                    a.href = courierLinks[index];
                    a.target = '_blank';
                    a.innerText = `${index + 1}. courier_id_${id}`;

                    const box = document.createElement('div');
                    box.className = 'courier-box';
                    box.appendChild(a);
                    outputDiv.appendChild(box);
                });
                document.getElementById('openAllButton').style.display = 'block';
                document.getElementById('copyLinksButton').style.display = 'block';
                document.getElementById('downloadCSVButton').style.display = 'block';

                // –ó–∞–ø–æ–ª–Ω—è–µ–º datalist –¥–ª—è –ø–æ–∏—Å–∫–∞
                let datalist = document.getElementById("courierSuggestions");
                datalist.innerHTML = "";
                courierIds.forEach(id => {
                    let option = document.createElement("option");
                    option.value = id;
                    datalist.appendChild(option);
                });
            } else {
                document.getElementById('output').innerHTML = '<p>–ù–µ –Ω–∞–π–¥–µ–Ω—ã –∞–π–¥–∏ –∫—É—Ä—å–µ—Ä–æ–≤.</p>';
            }
        }

        function resetOutput() {
            document.getElementById('output').innerHTML = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('searchInput').style.display = 'none';
            courierLinks = [];
            courierIds = [];
        }

        function filterCouriers() {
            let input = document.getElementById('searchInput').value.toLowerCase();
            let boxes = document.getElementsByClassName('courier-box');
            for (let box of boxes) {
                if (box.innerText.toLowerCase().includes(input)) {
                    box.style.display = '';
                } else {
                    box.style.display = 'none';
                }
            }
        }

        function openAllLinks() {
            courierLinks.forEach(link => {
                window.open(link, '_blank');
            });
        }

        function copyLinks() {
            navigator.clipboard.writeText(courierLinks.join('\n')).then(() => {
                alert('–í—Å–µ —Å—Å—ã–ª–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            });
        }

        function downloadCSV() {
            let csvContent = "courierIds\n" + courierIds.join("\n");
            let blob = new Blob([csvContent], { type: 'text/csv' });
            let link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "courier_ids.csv";
            link.click();
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–º—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        function updateFileName(inputId, spanId) {
            const input = document.getElementById(inputId);
            const span = document.getElementById(spanId);
            if (input.files.length > 0) {
                span.textContent = input.files[0].name;
            } else {
                span.textContent = "–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω";
            }
        }

        // –¢—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        }

        window.onload = function () {
            let themeToggle = document.getElementById('themeToggle');
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.checked = true;
            }
        };
    </script>
</body>
</html>
